{"ast":null,"code":"var _jsxFileName = \"/Users/sychen/thesis-app/packages/react-app/src/components/Pages/StakeItem.js\";\nimport React, { useState, useEffect } from \"react\";\nimport Jumbotron from '../Jumbotron';\nimport styled from 'styled-components';\nimport { ethers } from \"ethers\";\nimport { Contract } from \"@ethersproject/contracts\";\nimport { RINKEBY_ID, addresses, abis } from \"@uniswap-v2-app/contracts\";\nimport { Link } from 'react-router-dom';\nimport { ChainId, Token, WETH, Fetcher, Route } from '@uniswap/sdk';\nimport Container from '@material-ui/core/Container';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/Card';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\nimport TextField from '@material-ui/core/TextField';\nimport Icon from '@material-ui/core/Icon';\nimport Typography from '@material-ui/core/Typography';\nimport CardActions from '@material-ui/core/CardActions';\nimport { Button, CircularProgress } from '@material-ui/core';\nimport axios from 'axios';\nconst useStyles = makeStyles(theme => ({\n  container: {\n    marginTop: \"20px\"\n  },\n  root: {},\n  CardContent: {\n    backgroundColor: '#FFFFFF',\n    paddingTop: '2rem',\n    padding: '0px 2rem 2rem'\n  },\n  GridContainer: {\n    padding: '0px 30px 30px 0px'\n  },\n  bullet: {\n    display: 'inline-block',\n    margin: '0 2px',\n    transform: 'scale(0.8)'\n  },\n  title: {\n    fontSize: 14,\n    fontWeight: '600'\n  },\n  pos: {\n    marginBottom: 12\n  },\n  FormContent: {\n    padding: '0.5rem 1rem',\n    marginBottom: '1rem',\n    borderRadius: '1rem',\n    width: '100%',\n    border: '1px solid rgb(228, 232, 239)',\n    color: 'rgb(80, 80, 80)',\n    boxShadow: 'rgb(0 0 0 / 4%) 0px 1px 6px inset'\n  },\n  disabledFormContent: {\n    padding: '0.5rem 1rem',\n    marginBottom: '1rem',\n    borderRadius: '1rem',\n    width: '100%',\n    border: '1px solid rgb(228, 232, 239)',\n    color: 'rgb(80, 80, 80)',\n    boxShadow: 'rgb(0 0 0 / 4%) 0px 1px 6px inset',\n    background: 'rgb(228, 232, 239)'\n  },\n  symbol: {\n    fontSize: '1.5rem'\n  },\n  max: {\n    display: 'inline',\n    opacity: '1',\n    lineHeight: '1rem',\n    color: 'rgb(96, 211, 162)',\n    cursor: 'pointer'\n  },\n  currencyInput: {\n    padding: '1rem 1rem 1rem 0px',\n    textAlign: 'right',\n    border: 'none',\n    fontSize: '1.5rem',\n    fontWeight: '400',\n    width: '100%',\n    boxSizing: 'border-box',\n    appearance: 'none',\n    outline: 'none',\n    \"&:focus\": {\n      outline: 'none !important'\n    }\n  },\n  swapButton: {\n    color: '#24947A',\n    borderColor: '#24947A',\n    borderRadius: '50px',\n    float: 'right',\n    width: '100px',\n    fontSize: '14px',\n    loading: ''\n  }\n}));\nexport default function StakeItem(props) {\n  const classes = useStyles();\n  const provider = new ethers.providers.Web3Provider(window.ethereum);\n  const [policies, setPolicies] = useState(0);\n  const [minPremium, setminPremium] = useState(0);\n  const [totalDeposit, settotalDeposit] = useState('');\n  const [topupValue, setTopupValue] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [SYCAmount, setSYCAmount] = useState('');\n  const [SYCPrice, setSYCPrice] = useState(0);\n  const [ETHPrice, setETHPrice] = useState(0);\n  useEffect(() => {\n    const getETHPrice = async () => {\n      const priceInfo = await axios.get('https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT');\n      setETHPrice(priceInfo.data.price);\n    };\n\n    const getSYCPrice = async () => {\n      const SycWethExchangeContract = new Contract(addresses[RINKEBY_ID].pairs[\"SYC-WETH\"], abis.pair, provider);\n      const reserves = await SycWethExchangeContract.getReserves(); // reserves[0] is SYC, reserves[1] is ETHER\n\n      const k = reserves[0].mul(reserves[1]);\n      const y = ethers.utils.parseUnits('0.997', \"ether\").add(reserves[0]);\n      const x = ethers.utils.formatEther(reserves[1].sub(k.div(y)));\n      setSYCPrice(x.toString());\n    };\n\n    getSYCPrice();\n  }, []);\n  useEffect(() => {\n    const getPolicies = async () => {\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const signer = provider.getSigner();\n      const account = await signer.getAddress();\n      const policyFactoryContract = new Contract(addresses[RINKEBY_ID].policyFactory, abis.policyFactory, provider);\n      const policiesAddress = await policyFactoryContract.deployedPolicies(props.match.params.id);\n      const policy = new Contract(policiesAddress, abis.policy, provider);\n      const policyInfo = await policy.getSummary();\n      const stackOf = await policy.stackOf(account);\n      setminPremium(policyInfo[3]);\n      setPolicies(policyInfo);\n      settotalDeposit(stackOf.toString());\n    };\n\n    getPolicies();\n  }, []);\n\n  async function onMax() {\n    const signer = provider.getSigner();\n    const account = await signer.getAddress();\n    const balance = await provider.getBalance(account); // setETHAmount(ethers.utils.formatEther(balance.toString()))\n  }\n\n  async function onStake() {\n    setLoading(true);\n    const provider = new ethers.providers.Web3Provider(window.ethereum);\n    const signer = provider.getSigner();\n    const policyFactoryContract = new Contract(addresses[RINKEBY_ID].policyFactory, abis.policyFactory, signer);\n    const policyAddress = await policyFactoryContract.deployedPolicies(props.match.params.id);\n    const policy = new Contract(policyAddress, abis.policy, signer); // approve\n\n    const erc20Contract = new Contract(addresses[RINKEBY_ID].tokens.SYC, abis.erc20.abi, signer);\n    let tx = await erc20Contract.approve(policyAddress, ethers.utils.parseEther(topupValue));\n    await provider.waitForTransaction(tx.hash);\n    tx = await policy.createStake(topupValue);\n    await provider.waitForTransaction(tx.hash);\n    setLoading(false); // emit event\n  }\n\n  function total() {\n    if (totalDeposit && topupValue) return parseInt(totalDeposit) + parseInt(topupValue);\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Jumbotron, {\n    title: \"Deposit\",\n    description: \"Stake SYC on your selected project.\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Container, {\n    className: classes.container,\n    maxWidth: \"lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Card, {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(CardContent, {\n    className: classes.CardContent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    className: classes.GridContainer,\n    spacing: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Card, {\n    className: classes.FormContent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: \"flex\",\n      justifyContent: 'space-between'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    className: classes.title,\n    color: \"textPrimary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 25\n    }\n  }, \"Top Up\"), /*#__PURE__*/React.createElement(Button, {\n    className: classes.max,\n    onClick: e => {\n      onMax();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 25\n    }\n  }, \"Max\")), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: \"flex\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    className: classes.currencyInput,\n    placeholder: \"0\",\n    value: minPremium,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    align: \"right\",\n    className: classes.symbol,\n    display: \"inlign\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 25\n    }\n  }, \"SYC\")), /*#__PURE__*/React.createElement(Typography, {\n    className: classes.pos,\n    color: \"textSecondary\",\n    align: \"right\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 25\n    }\n  }, \"~$\", (SYCPrice * minPremium).toFixed(2)))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6,\n    style: {\n      cursor: 'not-allowed'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Card, {\n    className: classes.disabledFormContent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    disabled: true,\n    style: {\n      display: \"flex\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    className: classes.title,\n    color: \"textPrimary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 25\n    }\n  }, \"Total Deposit\")), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: \"flex\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    className: classes.currencyInput,\n    disabled: true,\n    style: {\n      cursor: 'not-allowed',\n      background: 'rgb(228, 232, 239)'\n    },\n    value: SYCAmount,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    align: \"right\",\n    className: classes.symbol,\n    display: \"inlign\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 25\n    }\n  }, \"SYC\")), /*#__PURE__*/React.createElement(Typography, {\n    className: classes.pos,\n    color: \"textSecondary\",\n    align: \"right\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 25\n    }\n  }, \"1 SYC = \", parseFloat(SYCPrice).toFixed(4), \" ETH\")))), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      'marginRight': '0'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"outlined\",\n    className: classes.swapButton,\n    onClick: e => onStake(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 21\n    }\n  }, loading && /*#__PURE__*/React.createElement(CircularProgress, {\n    size: 14,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 33\n    }\n  }), !loading && 'Stake'))))));\n}","map":{"version":3,"sources":["/Users/sychen/thesis-app/packages/react-app/src/components/Pages/StakeItem.js"],"names":["React","useState","useEffect","Jumbotron","styled","ethers","Contract","RINKEBY_ID","addresses","abis","Link","ChainId","Token","WETH","Fetcher","Route","Container","Card","CardContent","makeStyles","Grid","TextField","Icon","Typography","CardActions","Button","CircularProgress","axios","useStyles","theme","container","marginTop","root","backgroundColor","paddingTop","padding","GridContainer","bullet","display","margin","transform","title","fontSize","fontWeight","pos","marginBottom","FormContent","borderRadius","width","border","color","boxShadow","disabledFormContent","background","symbol","max","opacity","lineHeight","cursor","currencyInput","textAlign","boxSizing","appearance","outline","swapButton","borderColor","float","loading","StakeItem","props","classes","provider","providers","Web3Provider","window","ethereum","policies","setPolicies","minPremium","setminPremium","totalDeposit","settotalDeposit","topupValue","setTopupValue","setLoading","SYCAmount","setSYCAmount","SYCPrice","setSYCPrice","ETHPrice","setETHPrice","getETHPrice","priceInfo","get","data","price","getSYCPrice","SycWethExchangeContract","pairs","pair","reserves","getReserves","k","mul","y","utils","parseUnits","add","x","formatEther","sub","div","toString","getPolicies","signer","getSigner","account","getAddress","policyFactoryContract","policyFactory","policiesAddress","deployedPolicies","match","params","id","policy","policyInfo","getSummary","stackOf","onMax","balance","getBalance","onStake","policyAddress","erc20Contract","tokens","SYC","erc20","abi","tx","approve","parseEther","waitForTransaction","hash","createStake","total","parseInt","justifyContent","e","toFixed","parseFloat"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport Jumbotron from '../Jumbotron';\nimport styled from 'styled-components';\nimport { ethers } from \"ethers\";\nimport { Contract } from \"@ethersproject/contracts\";\nimport { RINKEBY_ID, addresses, abis } from \"@uniswap-v2-app/contracts\";\nimport { Link } from 'react-router-dom';\nimport { ChainId, Token, WETH, Fetcher, Route } from '@uniswap/sdk'\nimport Container from '@material-ui/core/Container';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/Card';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\nimport TextField from '@material-ui/core/TextField';\nimport Icon from '@material-ui/core/Icon';\nimport Typography from '@material-ui/core/Typography';\nimport CardActions from '@material-ui/core/CardActions';\nimport { Button, CircularProgress } from '@material-ui/core';\nimport axios from 'axios';\n\n\nconst useStyles = makeStyles((theme) => ({\n    container: {\n      marginTop: \"20px\",\n    },\n    root: {\n    },\n    CardContent: {\n      backgroundColor: '#FFFFFF',\n      paddingTop: '2rem',\n      padding: '0px 2rem 2rem'\n    },\n    GridContainer: {\n      padding: '0px 30px 30px 0px'\n    },\n    bullet: {\n      display: 'inline-block',\n      margin: '0 2px',\n      transform: 'scale(0.8)',\n    },\n    title: {\n      fontSize: 14,\n      fontWeight: '600'\n    },\n    pos: {\n      marginBottom: 12,\n    },\n    FormContent: {\n      padding: '0.5rem 1rem',\n      marginBottom: '1rem',\n      borderRadius: '1rem',\n      width: '100%',\n      border: '1px solid rgb(228, 232, 239)',\n      color: 'rgb(80, 80, 80)',\n      boxShadow: 'rgb(0 0 0 / 4%) 0px 1px 6px inset',\n    },\n    disabledFormContent: {\n      padding: '0.5rem 1rem',\n      marginBottom: '1rem',\n      borderRadius: '1rem',\n      width: '100%',\n      border: '1px solid rgb(228, 232, 239)',\n      color: 'rgb(80, 80, 80)',\n      boxShadow: 'rgb(0 0 0 / 4%) 0px 1px 6px inset',\n      background: 'rgb(228, 232, 239)'\n    },\n    symbol: {\n      fontSize: '1.5rem'\n    },\n    max: {\n      display: 'inline',\n      opacity: '1',\n      lineHeight: '1rem',\n      color: 'rgb(96, 211, 162)',\n      cursor: 'pointer'\n    },\n    currencyInput: {\n      padding: '1rem 1rem 1rem 0px',\n      textAlign: 'right',\n      border: 'none',\n      fontSize: '1.5rem',\n      fontWeight: '400',\n      width: '100%',\n      boxSizing: 'border-box',\n      appearance: 'none',\n      outline: 'none',\n      \"&:focus\": {\n        outline: 'none !important',\n      }\n    },\n    swapButton: {\n      color: '#24947A',\n      borderColor: '#24947A',\n      borderRadius: '50px',\n      float: 'right',\n      width: '100px',\n      fontSize: '14px',\n      loading: ''\n    }\n  }));\n  \n\nexport default function StakeItem(props) {\n    const classes = useStyles()\n    const provider = new ethers.providers.Web3Provider(window.ethereum)\n    const [policies, setPolicies] = useState(0);\n    const [minPremium, setminPremium] = useState(0);\n    const [totalDeposit, settotalDeposit] = useState('');\n    const [topupValue, setTopupValue] = useState('');\n    const [loading, setLoading] = useState(false);\n    const [SYCAmount, setSYCAmount] = useState('');\n    const [SYCPrice, setSYCPrice] = useState(0);\n    const [ETHPrice, setETHPrice] = useState(0);\n\n    useEffect(() => {\n        const getETHPrice = async () => {\n            const priceInfo = await axios.get('https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT')\n            setETHPrice(priceInfo.data.price)\n        }\n        const getSYCPrice = async () => {\n          const SycWethExchangeContract = new Contract(addresses[RINKEBY_ID].pairs[\"SYC-WETH\"], abis.pair, provider);\n          const reserves = await SycWethExchangeContract.getReserves();\n          // reserves[0] is SYC, reserves[1] is ETHER\n          const k = reserves[0].mul(reserves[1])\n          const y = ethers.utils.parseUnits('0.997', \"ether\").add(reserves[0])\n          const x = ethers.utils.formatEther(reserves[1].sub(k.div(y)));\n          setSYCPrice(x.toString())\n        }\n        getSYCPrice();\n      }, [])\n\n    useEffect(() => {\n        const getPolicies = async () => {\n            const provider = new ethers.providers.Web3Provider(window.ethereum)\n            const signer = provider.getSigner()\n            const account = await signer.getAddress()\n\n            const policyFactoryContract = new Contract(addresses[RINKEBY_ID].policyFactory, abis.policyFactory, provider)\n            const policiesAddress = await policyFactoryContract.deployedPolicies(props.match.params.id)\n            const policy = new Contract(policiesAddress, abis.policy, provider)\n            const policyInfo = await policy.getSummary()\n            const stackOf = await policy.stackOf(account)\n\n            setminPremium(policyInfo[3])\n            setPolicies(policyInfo)\n            settotalDeposit(stackOf.toString())\n        }\n\n        getPolicies();\n    }, []);\n\n    async function onMax() {\n        const signer = provider.getSigner()\n        const account = await signer.getAddress()\n        const balance = await provider.getBalance(account)\n        // setETHAmount(ethers.utils.formatEther(balance.toString()))\n      }\n    \n  \n\n    async function onStake() {\n        setLoading(true);\n        const provider = new ethers.providers.Web3Provider(window.ethereum);\n        const signer = provider.getSigner();\n        const policyFactoryContract = new Contract(addresses[RINKEBY_ID].policyFactory, abis.policyFactory, signer);\n        const policyAddress = await policyFactoryContract.deployedPolicies(props.match.params.id);\n        const policy = new Contract(policyAddress, abis.policy, signer);\n\n        // approve\n        const erc20Contract = new Contract(addresses[RINKEBY_ID].tokens.SYC, abis.erc20.abi, signer);\n        let tx = await erc20Contract.approve(\n        policyAddress,\n        ethers.utils.parseEther(topupValue)\n        );\n        await provider.waitForTransaction(tx.hash);\n        \n        tx = await policy.createStake(topupValue);\n\n        await provider.waitForTransaction(tx.hash);\n\n        setLoading(false);\n        // emit event\n    }\n\n    function total() {\n        if (totalDeposit && topupValue) return parseInt(totalDeposit)+parseInt(topupValue)\n    }\n\n\n\n    return (\n        <div>\n            <Jumbotron\n                title=\"Deposit\"\n                description=\"Stake SYC on your selected project.\" />\n            <Container className={classes.container} maxWidth='lg'>\n            <Card className={classes.root}>\n                <CardContent className={classes.CardContent}>\n                <Grid container className={classes.GridContainer} spacing={10}>\n                    <Grid item xs={12} sm={6}>\n                    <Card className={classes.FormContent}>\n                        <div style={{ display: \"flex\", justifyContent: 'space-between' }}>\n                        <Typography className={classes.title} color=\"textPrimary\">\n                            Top Up\n                        </Typography>\n                        <Button className={classes.max} onClick={e => {onMax()}}>\n                            Max\n                        </Button>\n                        </div>\n                        <div style={{ display: \"flex\" }}>\n                        <input \n                        className={classes.currencyInput}\n                        placeholder=\"0\"\n                        value={minPremium}\n                        />\n                        <Button align='right' className={classes.symbol} display='inlign'>\n                        SYC\n                        </Button>\n                        </div>\n                        \n                        <Typography className={classes.pos} color=\"textSecondary\" align='right'>\n                        ~${(SYCPrice * minPremium).toFixed(2)}\n                        </Typography>\n                    </Card>\n                    </Grid>\n                    <Grid item xs={12} sm={6} style={{ cursor: 'not-allowed'}}>\n                    <Card className={classes.disabledFormContent}>\n                        <div disabled style={{ display: \"flex\" }}>\n                        <Typography className={classes.title} color=\"textPrimary\">\n                        Total Deposit\n                        </Typography>\n                        </div>\n                        <div style={{ display: \"flex\" }}>\n                        <input \n                        className={classes.currencyInput}\n                        disabled\n                        style={{cursor: 'not-allowed', background: 'rgb(228, 232, 239)'}}\n                        value={SYCAmount}\n                        />\n                        <Button align='right' className={classes.symbol} display='inlign'>\n                        SYC\n                        </Button>\n                        </div>\n                        \n                        <Typography className={classes.pos} color=\"textSecondary\" align='right'>\n                        1 SYC = {parseFloat(SYCPrice).toFixed(4)} ETH\n                        </Typography>\n                    </Card>\n                    </Grid>\n                </Grid>\n                <div style={{ 'marginRight': '0' }}>\n                    <Button \n                    variant=\"outlined\" \n                    className={classes.swapButton}\n                    onClick={e => onStake()}\n                    >\n                    {loading && <CircularProgress size={14} />}\n                    {!loading && 'Stake'}   \n                    </Button>\n                </div> \n                </CardContent>\n            </Card>\n            </Container>\n      </div>\n    );\n}"]},"metadata":{},"sourceType":"module"}