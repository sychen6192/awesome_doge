{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sychen/thesis-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sychen/thesis-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/sychen/thesis-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import Jumbotron from'../Jumbotron';import styled from'styled-components';import{ethers}from\"ethers\";import{Contract}from\"@ethersproject/contracts\";import{RINKEBY_ID,addresses,abis}from\"@uniswap-v2-app/contracts\";import Link from'@material-ui/core/Link';import{makeStyles}from'@material-ui/core/styles';import Table from'@material-ui/core/Table';import TableBody from'@material-ui/core/TableBody';import TableCell from'@material-ui/core/TableCell';import TableContainer from'@material-ui/core/TableContainer';import TableHead from'@material-ui/core/TableHead';import TableRow from'@material-ui/core/TableRow';import Paper from'@material-ui/core/Paper';import Container from'@material-ui/core/Container';import Button from'@material-ui/core/Button';import CircularProgressWithLabel from'@material-ui/core/CircularProgress';import Box from'@material-ui/core/Box';import Typography from'@material-ui/core/Typography';import CircularProgress from'@material-ui/core/CircularProgress';import{green}from'@material-ui/core/colors';var useStyles=makeStyles(function(theme){return{table:{minWidth:650},approve:{margin:theme.spacing(3,0,2)},wrapper:{margin:theme.spacing(1),position:'relative'},buttonProgress:{position:'absolute',top:'50%',left:'50%',marginTop:-12}};});export default function StakeholdersPage(props){var classes=useStyles();var _useState=useState(0),_useState2=_slicedToArray(_useState,2),policyAddress=_useState2[0],setPolicyAddress=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),requests=_useState4[0],setRequests=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),stakeHolders=_useState6[0],setStakeHolders=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),stakeHoldersAddress=_useState8[0],setStakeHoldersAddress=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),delegatorCount=_useState10[0],setDelegatorCount=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loading=_useState12[0],setLoading=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),requestCount=_useState14[0],setRequestCount=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),isDelegator=_useState16[0],setIsDelegator=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),endorsers=_useState18[0],setEndorsers=_useState18[1];useEffect(function(){var getPolicies=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var provider,signer,account,policyFactoryContract,policiesAddress,policy,policyStakeHolders,requestCount,registryContract,delegatorCount,isDelegator,stakeholders,endorsers;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:provider=new ethers.providers.Web3Provider(window.ethereum);signer=provider.getSigner();_context.next=4;return signer.getAddress();case 4:account=_context.sent;policyFactoryContract=new Contract(addresses[RINKEBY_ID].policyFactory,abis.policyFactory,provider);_context.next=8;return policyFactoryContract.deployedPolicies(props.match.params.id);case 8:policiesAddress=_context.sent;policy=new Contract(policiesAddress,abis.policy,provider);_context.next=12;return policy.getPolicyStakeholders();case 12:policyStakeHolders=_context.sent;_context.next=15;return policy.getRequestsCount();case 15:requestCount=_context.sent;registryContract=new Contract(addresses[RINKEBY_ID].registry,abis.registry,provider);_context.next=19;return registryContract.getDelegatorCount();case 19:delegatorCount=_context.sent;_context.next=22;return registryContract.validDelegators(account);case 22:isDelegator=_context.sent;setStakeHoldersAddress(policyStakeHolders);setIsDelegator(isDelegator);setRequestCount(requestCount);setDelegatorCount(parseInt(delegatorCount.toString()));setPolicyAddress(policiesAddress);_context.next=30;return Promise.all(policyStakeHolders.map(function(address,index){return registryContract.mapInsurers(address);}));case 30:stakeholders=_context.sent;_context.next=33;return Promise.all(policyStakeHolders.map(function(endorser,index){return policy.endorser(endorser);}));case 33:endorsers=_context.sent;setEndorsers(endorsers);setStakeHolders(stakeholders);case 36:case\"end\":return _context.stop();}}},_callee);}));return function getPolicies(){return _ref.apply(this,arguments);};}();getPolicies();},[]);function delApprove(_x){return _delApprove.apply(this,arguments);}function _delApprove(){_delApprove=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(idx){var tx,provider,signer,policyContract;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;setLoading(true);provider=new ethers.providers.Web3Provider(window.ethereum);signer=provider.getSigner();policyContract=new Contract(policyAddress,abis.policy,signer);_context2.next=7;return policyContract.delApproveRequest(idx);case 7:tx=_context2.sent;_context2.next=10;return provider.waitForTransaction(tx.hash);case 10:setLoading(false);console.log(tx);_context2.next=17;break;case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 17:setLoading(false);case 18:case\"end\":return _context2.stop();}}},_callee2,null,[[0,14]]);}));return _delApprove.apply(this,arguments);}function Approve(_x2){return _Approve.apply(this,arguments);}function _Approve(){_Approve=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(idx){var tx,provider,signer,policyContract;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;setLoading(true);provider=new ethers.providers.Web3Provider(window.ethereum);signer=provider.getSigner();policyContract=new Contract(policyAddress,abis.policy,signer);_context3.next=7;return policyContract.approveRequest(idx);case 7:tx=_context3.sent;_context3.next=10;return provider.waitForTransaction(tx.hash);case 10:setLoading(false);console.log(tx);_context3.next=17;break;case 14:_context3.prev=14;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 17:setLoading(false);case 18:case\"end\":return _context3.stop();}}},_callee3,null,[[0,14]]);}));return _Approve.apply(this,arguments);}function Claim(_x3){return _Claim.apply(this,arguments);}function _Claim(){_Claim=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(idx){var tx,provider,signer,policyContract;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;setLoading(true);provider=new ethers.providers.Web3Provider(window.ethereum);signer=provider.getSigner();policyContract=new Contract(policyAddress,abis.policy,signer);_context4.next=7;return policyContract.claimRequest(idx);case 7:tx=_context4.sent;_context4.next=10;return provider.waitForTransaction(tx.hash);case 10:setLoading(false);console.log(tx);_context4.next=17;break;case 14:_context4.prev=14;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);case 17:setLoading(false);case 18:case\"end\":return _context4.stop();}}},_callee4,null,[[0,14]]);}));return _Claim.apply(this,arguments);}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Jumbotron,{title:\"Stakeholders\",description:\"Stakeholders List.\"}),/*#__PURE__*/React.createElement(Container,{className:classes.container,maxWidth:\"lg\"},/*#__PURE__*/React.createElement(TableContainer,{component:Paper},/*#__PURE__*/React.createElement(Table,{className:classes.table,\"aria-label\":\"simple table\"},/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,null,\"ID\"),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},\"Address\"),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},\"Name\"),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},\"Endorser\"))),/*#__PURE__*/React.createElement(TableBody,null,stakeHolders.map(function(stakeHolder,idx){return/*#__PURE__*/React.createElement(TableRow,{key:idx},/*#__PURE__*/React.createElement(TableCell,{component:\"th\",scope:\"row\"},idx+1),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},/*#__PURE__*/React.createElement(Typography,{color:\"textSecondary\"},stakeHoldersAddress[idx])),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},/*#__PURE__*/React.createElement(Typography,{color:\"primary\"},stakeHolder.userName)),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},/*#__PURE__*/React.createElement(Typography,{color:\"textSecondary\"},endorsers[idx].slice(0,6)+'...'+endorsers[idx].slice(-4))));}))))));}","map":{"version":3,"sources":["/Users/sychen/thesis-app/packages/react-app/src/components/Pages/StakeholdersPage.js"],"names":["React","useState","useEffect","Jumbotron","styled","ethers","Contract","RINKEBY_ID","addresses","abis","Link","makeStyles","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","Paper","Container","Button","CircularProgressWithLabel","Box","Typography","CircularProgress","green","useStyles","theme","table","minWidth","approve","margin","spacing","wrapper","position","buttonProgress","top","left","marginTop","StakeholdersPage","props","classes","policyAddress","setPolicyAddress","requests","setRequests","stakeHolders","setStakeHolders","stakeHoldersAddress","setStakeHoldersAddress","delegatorCount","setDelegatorCount","loading","setLoading","requestCount","setRequestCount","isDelegator","setIsDelegator","endorsers","setEndorsers","getPolicies","provider","providers","Web3Provider","window","ethereum","signer","getSigner","getAddress","account","policyFactoryContract","policyFactory","deployedPolicies","match","params","id","policiesAddress","policy","getPolicyStakeholders","policyStakeHolders","getRequestsCount","registryContract","registry","getDelegatorCount","validDelegators","parseInt","toString","Promise","all","map","address","index","mapInsurers","stakeholders","endorser","delApprove","idx","policyContract","delApproveRequest","tx","waitForTransaction","hash","console","log","Approve","approveRequest","Claim","claimRequest","container","stakeHolder","userName","slice"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport Jumbotron from '../Jumbotron';\nimport styled from 'styled-components';\nimport { ethers } from \"ethers\";\nimport { Contract } from \"@ethersproject/contracts\";\nimport { RINKEBY_ID, addresses, abis } from \"@uniswap-v2-app/contracts\";\nimport Link from '@material-ui/core/Link';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper';\nimport Container from '@material-ui/core/Container';\nimport Button from '@material-ui/core/Button';\nimport CircularProgressWithLabel from '@material-ui/core/CircularProgress';\nimport Box from '@material-ui/core/Box';\nimport Typography from '@material-ui/core/Typography';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { green } from '@material-ui/core/colors';\n\n\nconst useStyles = makeStyles((theme) => ({\n    table: {\n        minWidth: 650,\n    },\n    approve: {\n        margin: theme.spacing(3, 0, 2),\n    },\n    wrapper: {\n        margin: theme.spacing(1),\n        position: 'relative',\n      },\n      buttonProgress: {\n        position: 'absolute',\n        top: '50%',\n        left: '50%',\n        marginTop: -12,\n      },\n    \n}));\n\nexport default function StakeholdersPage(props) {\n    const classes = useStyles();\n    const [policyAddress, setPolicyAddress] = useState(0);\n    const [requests, setRequests] = useState([]);\n    const [stakeHolders, setStakeHolders] = useState([]);\n    const [stakeHoldersAddress, setStakeHoldersAddress] = useState([]);\n    const [delegatorCount, setDelegatorCount] = useState(0);\n    const [loading, setLoading] = useState(false);\n    const [requestCount, setRequestCount] = useState(0);\n    const [isDelegator, setIsDelegator] = useState(false);\n    const [endorsers, setEndorsers] = useState([]);\n\n    useEffect(() => {\n        const getPolicies = async () => {\n            const provider = new ethers.providers.Web3Provider(window.ethereum)\n            const signer = provider.getSigner()\n            const account = await signer.getAddress()\n\n            const policyFactoryContract = new Contract(addresses[RINKEBY_ID].policyFactory, abis.policyFactory, provider)\n            const policiesAddress = await policyFactoryContract.deployedPolicies(props.match.params.id)\n            const policy = new Contract(policiesAddress, abis.policy, provider)\n            const policyStakeHolders = await policy.getPolicyStakeholders();\n            const requestCount = await policy.getRequestsCount();\n            const registryContract = new Contract(addresses[RINKEBY_ID].registry, abis.registry, provider)\n            const delegatorCount = await registryContract.getDelegatorCount()\n            const isDelegator = await registryContract.validDelegators(account)\n\n            setStakeHoldersAddress(policyStakeHolders)\n            setIsDelegator(isDelegator)\n            setRequestCount(requestCount);\n            setDelegatorCount(parseInt(delegatorCount.toString()));\n            setPolicyAddress(policiesAddress)\n            const stakeholders = await Promise.all(\n                policyStakeHolders.map((address, index) => {\n                        return registryContract.mapInsurers(address)\n                    })\n            );\n            const endorsers = await Promise.all(\n                policyStakeHolders.map((endorser, index) => {\n                        return policy.endorser(endorser)\n                    })\n            );\n            setEndorsers(endorsers)\n            setStakeHolders(stakeholders)\n        }\n\n\n        getPolicies();\n    }, []);\n\n\n\n    async function delApprove(idx) {\n        try {\n            let tx;\n            setLoading(true);\n            const provider = new ethers.providers.Web3Provider(window.ethereum);\n            const signer = provider.getSigner()\n            const policyContract = new Contract(policyAddress, abis.policy, signer);\n            tx = await policyContract.delApproveRequest(\n                idx\n            );\n            // until transactionHash is mined.\n            await provider.waitForTransaction(tx.hash);\n            setLoading(false);\n            console.log(tx);\n        } catch (err) {\n            console.log(err)\n        }\n        setLoading(false);\n    }\n\n    async function Approve(idx) {\n        try {\n            let tx;\n            setLoading(true);\n            const provider = new ethers.providers.Web3Provider(window.ethereum);\n            const signer = provider.getSigner()\n            const policyContract = new Contract(policyAddress, abis.policy, signer);\n            tx = await policyContract.approveRequest(\n                idx\n            );\n            // until transactionHash is mined.\n            await provider.waitForTransaction(tx.hash);\n            setLoading(false);\n            console.log(tx);\n        } catch (err) {\n            console.log(err)\n        }\n        setLoading(false);\n    }\n\n    async function Claim(idx) {\n        try {\n            let tx;\n            setLoading(true);\n            const provider = new ethers.providers.Web3Provider(window.ethereum);\n            const signer = provider.getSigner()\n            const policyContract = new Contract(policyAddress, abis.policy, signer);\n            tx = await policyContract.claimRequest(\n                idx\n            );\n            // until transactionHash is mined.\n            await provider.waitForTransaction(tx.hash);\n            setLoading(false);\n            console.log(tx);\n        } catch (err) {\n            console.log(err)\n        }\n        setLoading(false);\n    }\n\n\n    return (\n        <div>\n            <Jumbotron\n                title=\"Stakeholders\"\n                description=\"Stakeholders List.\" />\n            <Container className={classes.container} maxWidth='lg'>\n\n                <TableContainer component={Paper}>\n                    <Table className={classes.table} aria-label=\"simple table\">\n                        <TableHead>\n                            <TableRow>\n                                <TableCell>ID</TableCell>\n                                <TableCell align=\"right\">Address</TableCell>\n                                <TableCell align=\"right\">Name</TableCell>\n                                <TableCell align=\"right\">Endorser</TableCell>\n                            </TableRow>\n                        </TableHead>\n                        <TableBody>\n                            {stakeHolders.map((stakeHolder, idx) => (\n                                <TableRow key={idx}>\n                                    <TableCell component=\"th\" scope=\"row\">\n                                        {idx+1}\n                                    </TableCell>\n                                    <TableCell align=\"right\">\n                                        <Typography color=\"textSecondary\">\n                                            {stakeHoldersAddress[idx]}\n                                        </Typography>\n                                    </TableCell>\n                                    <TableCell align=\"right\">\n                                        <Typography color=\"primary\">\n                                            {stakeHolder.userName}\n                                        </Typography>\n                                    </TableCell>\n                                    <TableCell align=\"right\">\n                                        <Typography color=\"textSecondary\">\n                                            {endorsers[idx].slice(0, 6)+'...'+endorsers[idx].slice(-4)}\n                                        </Typography>\n                                    </TableCell>\n                                </TableRow>\n                            ))}\n                        </TableBody>\n                    </Table>\n                </TableContainer>\n            </Container>\n        </div>\n    );\n}"]},"metadata":{},"sourceType":"module"}