{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sychen/thesis-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sychen/thesis-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/sychen/thesis-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{ethers}from\"ethers\";import{Contract}from\"@ethersproject/contracts\";import styled from'styled-components';import{RINKEBY_ID,addresses,abis}from\"@uniswap-v2-app/contracts\";import Container from'@material-ui/core/Container';import Typography from'@material-ui/core/Typography';import Grid from'@material-ui/core/Grid';import TextField from'@material-ui/core/TextField';import MenuItem from'@material-ui/core/MenuItem';import Select from'@material-ui/core/Select';import{makeStyles}from'@material-ui/core/styles';import InputLabel from'@material-ui/core/InputLabel';import Button from'@material-ui/core/Button';import Avatar from'@material-ui/core/Avatar';import ipfs from'../../ipfs';import CloudUploadIcon from'@material-ui/icons/CloudUpload';import FacebookLogin from'react-facebook-login';import PolicyIcon from'@material-ui/icons/Policy';import CssBaseline from'@material-ui/core/CssBaseline';import AccountCircle from'@material-ui/icons/AccountCircle';import FacebookIcon from'@material-ui/icons/Facebook';import InputAdornment from'@material-ui/core/InputAdornment';import{DateTimePicker,MuiPickersUtilsProvider}from\"@material-ui/pickers\";import DateFnsUtils from'@date-io/date-fns';// choose your lib\nimport Backdrop from'@material-ui/core/Backdrop';import CircularProgress from'@material-ui/core/CircularProgress';var useStyles=makeStyles(function(theme){return{container:{marginTop:\"20px\",width:'800px',marginLeft:'auto',marginRight:'auto',backgroundColor:'white',padding:'30px 30px 30px 30px',borderRadius:'10px'},avatar:{margin:theme.spacing(1),backgroundColor:theme.palette.secondary.main},paper:{marginTop:theme.spacing(8),display:'flex',flexDirection:'column',alignItems:'center'},textField:{marginLeft:theme.spacing(1),marginRight:theme.spacing(1),width:200},form:{width:'100%',// Fix IE 11 issue.\nmarginTop:theme.spacing(3)}};});export default function PolicyInputPanel(){var classes=useStyles();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),policyName=_useState4[0],setPolicyName=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),policyType=_useState6[0],setPolicyType=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),policyContent=_useState8[0],setPolicyContent=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),policyPremium=_useState10[0],setPolicyPremium=_useState10[1];var _useState11=useState(new Date()),_useState12=_slicedToArray(_useState11,2),policyStart=_useState12[0],setPolicyStart=_useState12[1];var _useState13=useState(new Date()),_useState14=_slicedToArray(_useState13,2),policyEnd=_useState14[0],setPolicyEnd=_useState14[1];var _useState15=useState(new Date()),_useState16=_slicedToArray(_useState15,2),policyDeadline=_useState16[0],setPolicyDeadline=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),buffer=_useState18[0],setBuffer=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),contentHash=_useState20[0],setContentHash=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),login=_useState22[0],setLogin=_useState22[1];var _useState23=useState({}),_useState24=_slicedToArray(_useState23,2),data=_useState24[0],setData=_useState24[1];var responseFacebook=function responseFacebook(response){console.log(response);setData(response);if(response.accessToken){setLogin(true);}else{setLogin(false);}};function dateToUnix(value){var date=new Date(value);return parseInt(date.getTime()/Math.pow(10,3));}var captureFile=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var file,reader,data,postResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);console.log('capture file...');event.preventDefault();file=event.target.files[0];reader=new window.FileReader();reader.readAsArrayBuffer(file);reader.onloadend=function(){setBuffer(Buffer.from(reader.result));};// upload\ndata=buffer;console.log('Submit this: ',data);_context.next=11;return ipfs.add(data);case 11:postResponse=_context.sent;console.log(\"hash: \",postResponse['path']);setPolicyContent(postResponse['path']);setLoading(false);case 15:case\"end\":return _context.stop();}}},_callee);}));return function captureFile(_x){return _ref.apply(this,arguments);};}();function createPolicy(){return _createPolicy.apply(this,arguments);}function _createPolicy(){_createPolicy=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var tx,provider,signer,policyFactoryContract;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;console.log(ethers.utils.parseEther(policyPremium));console.log(dateToUnix(policyStart),dateToUnix(policyEnd));console.log(dateToUnix(policyDeadline));setLoading(true);provider=new ethers.providers.Web3Provider(window.ethereum);signer=provider.getSigner();policyFactoryContract=new Contract(addresses[RINKEBY_ID].policyFactory,abis.policyFactory,signer);console.log(policyFactoryContract);_context2.next=11;return policyFactoryContract.createPolicy(policyName,policyType,ethers.utils.parseEther(policyPremium),dateToUnix(policyStart),dateToUnix(policyEnd),policyContent,dateToUnix(policyDeadline));case 11:tx=_context2.sent;_context2.next=14;return provider.waitForTransaction(tx.hash);case 14:setLoading(false);console.log(tx);_context2.next=21;break;case 18:_context2.prev=18;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 21:setLoading(false);case 22:case\"end\":return _context2.stop();}}},_callee2,null,[[0,18]]);}));return _createPolicy.apply(this,arguments);}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Backdrop,{className:classes.backdrop,open:loading},/*#__PURE__*/React.createElement(CircularProgress,{color:\"inherit\"})),/*#__PURE__*/React.createElement(MuiPickersUtilsProvider,{utils:DateFnsUtils},/*#__PURE__*/React.createElement(Container,{component:\"main\",maxWidth:\"md\"},/*#__PURE__*/React.createElement(CssBaseline,null),/*#__PURE__*/React.createElement(\"div\",{className:classes.paper},/*#__PURE__*/React.createElement(Grid,{container:true,justify:\"center\"}),/*#__PURE__*/React.createElement(Grid,{container:true},/*#__PURE__*/React.createElement(FacebookLogin,{appId:\"360104115420180\",autoLoad:false,fields:\"name,email\",scope:\"public_profile\",size:\"small\",callback:responseFacebook,icon:\"fa-facebook\"})),/*#__PURE__*/React.createElement(\"form\",{className:classes.form,noValidate:true},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:4},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6},/*#__PURE__*/React.createElement(TextField,{required:true,id:\"Proposer\",label:\"Proposer\",value:data.name,disabled:true,fullWidth:true,InputProps:{startAdornment:/*#__PURE__*/React.createElement(InputAdornment,{position:\"start\"},/*#__PURE__*/React.createElement(AccountCircle,null))}})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6},/*#__PURE__*/React.createElement(TextField,{required:true,id:\"UserId\",label:\"UserId\",value:data.id,disabled:true,fullWidth:true,InputProps:{startAdornment:/*#__PURE__*/React.createElement(InputAdornment,{position:\"start\"},/*#__PURE__*/React.createElement(FacebookIcon,null))}})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6},/*#__PURE__*/React.createElement(TextField,{required:true,id:\"policyName\",label:\"Title\",onChange:function onChange(e){return setPolicyName(e.target.value);},fullWidth:true})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6},/*#__PURE__*/React.createElement(TextField,{id:\"standard-select-type\",required:true,select:true,label:\"Type\",value:policyType,onChange:function onChange(e){return setPolicyType(e.target.value);},helperText:\"Please select your insurance type\",fullWidth:true},/*#__PURE__*/React.createElement(MenuItem,{value:\"Cyper Insurance\"},\"Cyper Insurance\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"Health Insurance\"},\"Health Insurance\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"Investment Insurance\"},\"Investment Insurance\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"Auto Insurance\"},\"Auto Insurance\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"Oracle BTC\"},\"Oracle BTC insurance\"))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6},/*#__PURE__*/React.createElement(DateTimePicker,{value:policyStart,disablePast:true,onChange:function onChange(e){return setPolicyStart(e);},label:\"Start time\",showTodayButton:true,fullWidth:true})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6},/*#__PURE__*/React.createElement(DateTimePicker,{value:policyEnd,disablePast:true,onChange:function onChange(e){return setPolicyEnd(e);},label:\"End time\",showTodayButton:true,fullWidth:true})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6},/*#__PURE__*/React.createElement(DateTimePicker,{value:policyDeadline,disablePast:true,onChange:function onChange(e){return setPolicyDeadline(e);},label:\"Deadline\",showTodayButton:true,fullWidth:true})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:9},/*#__PURE__*/React.createElement(TextField,{required:true,id:\"policyContent\",name:\"policyContent\",label:\"Content Hash\",value:policyContent,disabled:true,fullWidth:true})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:3},/*#__PURE__*/React.createElement(\"input\",{type:\"file\",accept:\".pdf,.word,.jpg\",className:classes.input,style:{display:'none'},id:\"contained-button-file\",multiple:true,onChange:function onChange(e){return captureFile(e);}}),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"contained-button-file\"},/*#__PURE__*/React.createElement(Button,{variant:\"contained\",component:\"span\",className:classes.button,startIcon:/*#__PURE__*/React.createElement(CloudUploadIcon,null)},\"Upload Policy\"))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,sm:6},/*#__PURE__*/React.createElement(TextField,{required:true,id:\"Policypremium\",name:\"Policypremium\",label:\"Claim Base\",onChange:function onChange(e){return setPolicyPremium(e.target.value);},fullWidth:true})),/*#__PURE__*/React.createElement(Grid,{justify:\"flex-end\",container:true},/*#__PURE__*/React.createElement(Grid,null,/*#__PURE__*/React.createElement(Button,{variant:\"contained\",component:\"span\",onClick:createPolicy,className:classes.button},\"Create\")))))))));}","map":{"version":3,"sources":["/Users/sychen/thesis-app/packages/react-app/src/components/PolicyInputPanel/index.js"],"names":["React","useState","useEffect","ethers","Contract","styled","RINKEBY_ID","addresses","abis","Container","Typography","Grid","TextField","MenuItem","Select","makeStyles","InputLabel","Button","Avatar","ipfs","CloudUploadIcon","FacebookLogin","PolicyIcon","CssBaseline","AccountCircle","FacebookIcon","InputAdornment","DateTimePicker","MuiPickersUtilsProvider","DateFnsUtils","Backdrop","CircularProgress","useStyles","theme","container","marginTop","width","marginLeft","marginRight","backgroundColor","padding","borderRadius","avatar","margin","spacing","palette","secondary","main","paper","display","flexDirection","alignItems","textField","form","PolicyInputPanel","classes","loading","setLoading","policyName","setPolicyName","policyType","setPolicyType","policyContent","setPolicyContent","policyPremium","setPolicyPremium","Date","policyStart","setPolicyStart","policyEnd","setPolicyEnd","policyDeadline","setPolicyDeadline","buffer","setBuffer","contentHash","setContentHash","login","setLogin","data","setData","responseFacebook","response","console","log","accessToken","dateToUnix","value","date","parseInt","getTime","captureFile","event","preventDefault","file","target","files","reader","window","FileReader","readAsArrayBuffer","onloadend","Buffer","from","result","add","postResponse","createPolicy","utils","parseEther","provider","providers","Web3Provider","ethereum","signer","getSigner","policyFactoryContract","policyFactory","tx","waitForTransaction","hash","backdrop","name","startAdornment","id","e","input","button"],"mappings":"0aAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,OAASC,MAAT,KAAuB,QAAvB,CACA,OAASC,QAAT,KAAyB,0BAAzB,CACA,MAAOC,CAAAA,MAAP,KAAmB,mBAAnB,CACA,OAASC,UAAT,CAAqBC,SAArB,CAAgCC,IAAhC,KAA4C,2BAA5C,CACA,MAAOC,CAAAA,SAAP,KAAsB,6BAAtB,CACA,MAAOC,CAAAA,UAAP,KAAuB,8BAAvB,CACA,MAAOC,CAAAA,IAAP,KAAiB,wBAAjB,CACA,MAAOC,CAAAA,SAAP,KAAsB,6BAAtB,CACA,MAAOC,CAAAA,QAAP,KAAqB,4BAArB,CACA,MAAOC,CAAAA,MAAP,KAAmB,0BAAnB,CACA,OAASC,UAAT,KAA2B,0BAA3B,CACA,MAAOC,CAAAA,UAAP,KAAuB,8BAAvB,CACA,MAAOC,CAAAA,MAAP,KAAmB,0BAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,0BAAnB,CACA,MAAOC,CAAAA,IAAP,KAAiB,YAAjB,CACA,MAAOC,CAAAA,eAAP,KAA4B,gCAA5B,CACA,MAAOC,CAAAA,aAAP,KAA0B,sBAA1B,CACA,MAAOC,CAAAA,UAAP,KAAuB,2BAAvB,CACA,MAAOC,CAAAA,WAAP,KAAwB,+BAAxB,CACA,MAAOC,CAAAA,aAAP,KAA0B,kCAA1B,CACA,MAAOC,CAAAA,YAAP,KAAyB,6BAAzB,CACA,MAAOC,CAAAA,cAAP,KAA2B,kCAA3B,CACA,OAASC,cAAT,CAAyBC,uBAAzB,KAAwD,sBAAxD,CACA,MAAOC,CAAAA,YAAP,KAAyB,mBAAzB,CAA8C;AAC9C,MAAOC,CAAAA,QAAP,KAAqB,4BAArB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,oCAA7B,CAGA,GAAMC,CAAAA,SAAS,CAAGjB,UAAU,CAAC,SAACkB,KAAD,QAAY,CACrCC,SAAS,CAAE,CACTC,SAAS,CAAE,MADF,CAETC,KAAK,CAAE,OAFE,CAGTC,UAAU,CAAE,MAHH,CAITC,WAAW,CAAE,MAJJ,CAKTC,eAAe,CAAE,OALR,CAMTC,OAAO,CAAE,qBANA,CAOTC,YAAY,CAAE,MAPL,CAD0B,CAUrCC,MAAM,CAAE,CACNC,MAAM,CAAEV,KAAK,CAACW,OAAN,CAAc,CAAd,CADF,CAENL,eAAe,CAAEN,KAAK,CAACY,OAAN,CAAcC,SAAd,CAAwBC,IAFnC,CAV6B,CAcrCC,KAAK,CAAE,CACLb,SAAS,CAAEF,KAAK,CAACW,OAAN,CAAc,CAAd,CADN,CAELK,OAAO,CAAE,MAFJ,CAGLC,aAAa,CAAE,QAHV,CAILC,UAAU,CAAE,QAJP,CAd8B,CAoBrCC,SAAS,CAAE,CACTf,UAAU,CAAEJ,KAAK,CAACW,OAAN,CAAc,CAAd,CADH,CAETN,WAAW,CAAEL,KAAK,CAACW,OAAN,CAAc,CAAd,CAFJ,CAGTR,KAAK,CAAE,GAHE,CApB0B,CAyBrCiB,IAAI,CAAE,CACJjB,KAAK,CAAE,MADH,CACW;AACfD,SAAS,CAAEF,KAAK,CAACW,OAAN,CAAc,CAAd,CAFP,CAzB+B,CAAZ,EAAD,CAA5B,CAgCA,cAAe,SAASU,CAAAA,gBAAT,EAA4B,CACvC,GAAMC,CAAAA,OAAO,CAAGvB,SAAS,EAAzB,CADuC,cAGT/B,QAAQ,CAAC,KAAD,CAHC,wCAGhCuD,OAHgC,eAGvBC,UAHuB,8BAIHxD,QAAQ,CAAC,CAAD,CAJL,yCAIhCyD,UAJgC,eAIpBC,aAJoB,8BAKH1D,QAAQ,CAAC,CAAD,CALL,yCAKhC2D,UALgC,eAKpBC,aALoB,8BAMG5D,QAAQ,CAAC,EAAD,CANX,yCAMhC6D,aANgC,eAMjBC,gBANiB,8BAOG9D,QAAQ,CAAC,CAAD,CAPX,0CAOhC+D,aAPgC,gBAOjBC,gBAPiB,gCAQDhE,QAAQ,CAAC,GAAIiE,CAAAA,IAAJ,EAAD,CARP,2CAQhCC,WARgC,gBAQnBC,cARmB,gCASLnE,QAAQ,CAAC,GAAIiE,CAAAA,IAAJ,EAAD,CATH,2CAShCG,SATgC,gBASrBC,YATqB,gCAUKrE,QAAQ,CAAC,GAAIiE,CAAAA,IAAJ,EAAD,CAVb,2CAUhCK,cAVgC,gBAUhBC,iBAVgB,gCAYXvE,QAAQ,CAAC,EAAD,CAZG,2CAYhCwE,MAZgC,gBAYxBC,SAZwB,gCAaDzE,QAAQ,CAAC,EAAD,CAbP,2CAahC0E,WAbgC,gBAanBC,cAbmB,gCAcb3E,QAAQ,CAAC,KAAD,CAdK,2CAchC4E,KAdgC,gBAczBC,QAdyB,gCAef7E,QAAQ,CAAC,EAAD,CAfO,2CAehC8E,IAfgC,gBAe1BC,OAf0B,gBAiBvC,GAAMC,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACC,QAAD,CAAc,CACrCC,OAAO,CAACC,GAAR,CAAYF,QAAZ,EACAF,OAAO,CAACE,QAAD,CAAP,CACA,GAAIA,QAAQ,CAACG,WAAb,CAA0B,CACxBP,QAAQ,CAAC,IAAD,CAAR,CACD,CAFD,IAEO,CACLA,QAAQ,CAAC,KAAD,CAAR,CACD,CACF,CARD,CAWA,QAASQ,CAAAA,UAAT,CAAoBC,KAApB,CAA2B,CACvB,GAAMC,CAAAA,IAAI,CAAG,GAAItB,CAAAA,IAAJ,CAASqB,KAAT,CAAb,CACA,MAAOE,CAAAA,QAAQ,CAACD,IAAI,CAACE,OAAL,YAAiB,EAAjB,CAAqB,CAArB,CAAD,CAAf,CACH,CAED,GAAMC,CAAAA,WAAW,0FAAG,iBAAMC,KAAN,oJAClBnC,UAAU,CAAC,IAAD,CAAV,CACA0B,OAAO,CAACC,GAAR,CAAY,iBAAZ,EACAQ,KAAK,CAACC,cAAN,GACMC,IAJY,CAILF,KAAK,CAACG,MAAN,CAAaC,KAAb,CAAmB,CAAnB,CAJK,CAKZC,MALY,CAKH,GAAIC,CAAAA,MAAM,CAACC,UAAX,EALG,CAMlBF,MAAM,CAACG,iBAAP,CAAyBN,IAAzB,EACAG,MAAM,CAACI,SAAP,CAAmB,UAAM,CACvB3B,SAAS,CAAC4B,MAAM,CAACC,IAAP,CAAYN,MAAM,CAACO,MAAnB,CAAD,CAAT,CACD,CAFD,CAGA;AACIzB,IAXc,CAWPN,MAXO,CAYlBU,OAAO,CAACC,GAAR,CAAY,eAAZ,CAA6BL,IAA7B,EAZkB,uBAaS5D,CAAAA,IAAI,CAACsF,GAAL,CAAS1B,IAAT,CAbT,SAaZ2B,YAbY,eAclBvB,OAAO,CAACC,GAAR,CAAY,QAAZ,CAAsBsB,YAAY,CAAC,MAAD,CAAlC,EACA3C,gBAAgB,CAAC2C,YAAY,CAAC,MAAD,CAAb,CAAhB,CACAjD,UAAU,CAAC,KAAD,CAAV,CAhBkB,uDAAH,kBAAXkC,CAAAA,WAAW,4CAAjB,CAjCuC,QAqDxBgB,CAAAA,YArDwB,8IAqDvC,sMAEMxB,OAAO,CAACC,GAAR,CAAYjF,MAAM,CAACyG,KAAP,CAAaC,UAAb,CAAwB7C,aAAxB,CAAZ,EACAmB,OAAO,CAACC,GAAR,CAAYE,UAAU,CAACnB,WAAD,CAAtB,CAAqCmB,UAAU,CAACjB,SAAD,CAA/C,EACAc,OAAO,CAACC,GAAR,CAAYE,UAAU,CAACf,cAAD,CAAtB,EAEEd,UAAU,CAAC,IAAD,CAAV,CACMqD,QAPd,CAOyB,GAAI3G,CAAAA,MAAM,CAAC4G,SAAP,CAAiBC,YAArB,CAAkCd,MAAM,CAACe,QAAzC,CAPzB,CAQcC,MARd,CAQuBJ,QAAQ,CAACK,SAAT,EARvB,CAScC,qBATd,CASsC,GAAIhH,CAAAA,QAAJ,CAAaG,SAAS,CAACD,UAAD,CAAT,CAAsB+G,aAAnC,CAAkD7G,IAAI,CAAC6G,aAAvD,CAAsEH,MAAtE,CATtC,CAUQ/B,OAAO,CAACC,GAAR,CAAYgC,qBAAZ,EAVR,wBAWmBA,CAAAA,qBAAqB,CAACT,YAAtB,CACPjD,UADO,CAEPE,UAFO,CAGPzD,MAAM,CAACyG,KAAP,CAAaC,UAAb,CAAwB7C,aAAxB,CAHO,CAIPsB,UAAU,CAACnB,WAAD,CAJH,CAKPmB,UAAU,CAACjB,SAAD,CALH,CAMPP,aANO,CAOPwB,UAAU,CAACf,cAAD,CAPH,CAXnB,SAWQ+C,EAXR,wCAqBcR,CAAAA,QAAQ,CAACS,kBAAT,CAA4BD,EAAE,CAACE,IAA/B,CArBd,SAsBQ/D,UAAU,CAAC,KAAD,CAAV,CACA0B,OAAO,CAACC,GAAR,CAAYkC,EAAZ,EAvBR,qFAyBQnC,OAAO,CAACC,GAAR,eAzBR,QA2BQ3B,UAAU,CAAC,KAAD,CAAV,CA3BR,uEArDuC,+CAkFvC,mBACE,4CACE,oBAAC,QAAD,EAAU,SAAS,CAAEF,OAAO,CAACkE,QAA7B,CAAuC,IAAI,CAAEjE,OAA7C,eACQ,oBAAC,gBAAD,EAAkB,KAAK,CAAC,SAAxB,EADR,CADF,cAIA,oBAAC,uBAAD,EAAyB,KAAK,CAAE3B,YAAhC,eACA,oBAAC,SAAD,EAAW,SAAS,CAAC,MAArB,CAA4B,QAAQ,CAAC,IAArC,eACE,oBAAC,WAAD,MADF,cAEE,2BAAK,SAAS,CAAE0B,OAAO,CAACP,KAAxB,eACA,oBAAC,IAAD,EAAM,SAAS,KAAf,CAAgB,OAAO,CAAG,QAA1B,EADA,cAGA,oBAAC,IAAD,EAAM,SAAS,KAAf,eACE,oBAAC,aAAD,EACA,KAAK,CAAC,iBADN,CAEA,QAAQ,CAAE,KAFV,CAGA,MAAM,CAAC,YAHP,CAIA,KAAK,CAAC,gBAJN,CAKA,IAAI,CAAC,OALL,CAMA,QAAQ,CAAEiC,gBANV,CAOA,IAAI,CAAC,aAPL,EADF,CAHA,cAaF,4BAAM,SAAS,CAAE1B,OAAO,CAACF,IAAzB,CAA+B,UAAU,KAAzC,eACA,oBAAC,IAAD,EAAM,SAAS,KAAf,CAAgB,OAAO,CAAE,CAAzB,eACA,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,EAAE,CAAE,CAAvB,eACI,oBAAC,SAAD,EACE,QAAQ,KADV,CAEE,EAAE,CAAC,UAFL,CAGE,KAAK,CAAC,UAHR,CAIE,KAAK,CAAE0B,IAAI,CAAC2C,IAJd,CAKE,QAAQ,KALV,CAME,SAAS,KANX,CAOE,UAAU,CAAE,CACVC,cAAc,cACZ,oBAAC,cAAD,EAAgB,QAAQ,CAAC,OAAzB,eACE,oBAAC,aAAD,MADF,CAFQ,CAPd,EADJ,CADA,cAkBE,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,EAAE,CAAE,CAAvB,eACE,oBAAC,SAAD,EACE,QAAQ,KADV,CAEE,EAAE,CAAC,QAFL,CAGE,KAAK,CAAC,QAHR,CAIE,KAAK,CAAE5C,IAAI,CAAC6C,EAJd,CAKE,QAAQ,KALV,CAME,SAAS,KANX,CAOE,UAAU,CAAE,CACVD,cAAc,cACd,oBAAC,cAAD,EAAgB,QAAQ,CAAC,OAAzB,eACE,oBAAC,YAAD,MADF,CAFU,CAPd,EADF,CAlBF,cAmCE,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,EAAE,CAAE,CAAvB,eACE,oBAAC,SAAD,EACE,QAAQ,KADV,CAEE,EAAE,CAAC,YAFL,CAGE,KAAK,CAAC,OAHR,CAIE,QAAQ,CAAE,kBAAAE,CAAC,QAAIlE,CAAAA,aAAa,CAACkE,CAAC,CAAC9B,MAAF,CAASR,KAAV,CAAjB,EAJb,CAKE,SAAS,KALX,EADF,CAnCF,cA4CE,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,EAAE,CAAE,CAAvB,eACA,oBAAC,SAAD,EACE,EAAE,CAAC,sBADL,CAEE,QAAQ,KAFV,CAGE,MAAM,KAHR,CAIE,KAAK,CAAC,MAJR,CAKE,KAAK,CAAE3B,UALT,CAME,QAAQ,CAAE,kBAAAiE,CAAC,QAAIhE,CAAAA,aAAa,CAACgE,CAAC,CAAC9B,MAAF,CAASR,KAAV,CAAjB,EANb,CAOE,UAAU,CAAC,mCAPb,CAQE,SAAS,KARX,eAUI,oBAAC,QAAD,EAAU,KAAK,CAAC,iBAAhB,oBAVJ,cAWI,oBAAC,QAAD,EAAU,KAAK,CAAC,kBAAhB,qBAXJ,cAYI,oBAAC,QAAD,EAAU,KAAK,CAAC,sBAAhB,yBAZJ,cAaI,oBAAC,QAAD,EAAU,KAAK,CAAC,gBAAhB,mBAbJ,cAcI,oBAAC,QAAD,EAAU,KAAK,CAAC,YAAhB,yBAdJ,CADA,CA5CF,cA+DE,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,EAAE,CAAE,CAAvB,eACA,oBAAC,cAAD,EACI,KAAK,CAAEpB,WADX,CAEI,WAAW,KAFf,CAGI,QAAQ,CAAE,kBAAA0D,CAAC,QAAIzD,CAAAA,cAAc,CAACyD,CAAD,CAAlB,EAHf,CAII,KAAK,CAAC,YAJV,CAKI,eAAe,KALnB,CAMI,SAAS,KANb,EADA,CA/DF,cA0EE,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,EAAE,CAAE,CAAvB,eACA,oBAAC,cAAD,EACI,KAAK,CAAExD,SADX,CAEI,WAAW,KAFf,CAGI,QAAQ,CAAE,kBAAAwD,CAAC,QAAIvD,CAAAA,YAAY,CAACuD,CAAD,CAAhB,EAHf,CAII,KAAK,CAAC,UAJV,CAKI,eAAe,KALnB,CAMI,SAAS,KANb,EADA,CA1EF,cAoFE,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,EAAE,CAAE,CAAvB,eACA,oBAAC,cAAD,EACI,KAAK,CAAEtD,cADX,CAEI,WAAW,KAFf,CAGI,QAAQ,CAAE,kBAAAsD,CAAC,QAAIrD,CAAAA,iBAAiB,CAACqD,CAAD,CAArB,EAHf,CAII,KAAK,CAAC,UAJV,CAKI,eAAe,KALnB,CAMI,SAAS,KANb,EADA,CApFF,cA+FE,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,EAAE,CAAE,CAAvB,eACE,oBAAC,SAAD,EACE,QAAQ,KADV,CAEE,EAAE,CAAC,eAFL,CAGE,IAAI,CAAC,eAHP,CAIE,KAAK,CAAC,cAJR,CAKE,KAAK,CAAE/D,aALT,CAME,QAAQ,KANV,CAOE,SAAS,KAPX,EADF,CA/FF,cA0GE,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,EAAE,CAAE,CAAvB,eACA,6BACQ,IAAI,CAAC,MADb,CAEQ,MAAM,CAAC,iBAFf,CAGQ,SAAS,CAAEP,OAAO,CAACuE,KAH3B,CAIQ,KAAK,CAAE,CAAE7E,OAAO,CAAE,MAAX,CAJf,CAKQ,EAAE,CAAC,uBALX,CAMQ,QAAQ,KANhB,CAOQ,QAAQ,CAAE,kBAAA4E,CAAC,QAAIlC,CAAAA,WAAW,CAACkC,CAAD,CAAf,EAPnB,EADA,cAUI,6BAAO,OAAO,CAAC,uBAAf,eACA,oBAAC,MAAD,EAAQ,OAAO,CAAC,WAAhB,CAA4B,SAAS,CAAC,MAAtC,CAA6C,SAAS,CAAEtE,OAAO,CAACwE,MAAhE,CAAwE,SAAS,cAAE,oBAAC,eAAD,MAAnF,kBADA,CAVJ,CA1GF,cA0HE,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,EAAE,CAAE,CAAvB,eACE,oBAAC,SAAD,EACE,QAAQ,KADV,CAEE,EAAE,CAAC,eAFL,CAGE,IAAI,CAAC,eAHP,CAIE,KAAK,CAAC,YAJR,CAKE,QAAQ,CAAE,kBAAAF,CAAC,QAAI5D,CAAAA,gBAAgB,CAAC4D,CAAC,CAAC9B,MAAF,CAASR,KAAV,CAApB,EALb,CAME,SAAS,KANX,EADF,CA1HF,cAqIE,oBAAC,IAAD,EAAM,OAAO,CAAC,UAAd,CAAyB,SAAS,KAAlC,eACE,oBAAC,IAAD,mBACA,oBAAC,MAAD,EAAQ,OAAO,CAAC,WAAhB,CAA4B,SAAS,CAAC,MAAtC,CAA6C,OAAO,CAAEoB,YAAtD,CAAoE,SAAS,CAAEpD,OAAO,CAACwE,MAAvF,WADA,CADF,CArIF,CADA,CAbE,CAFF,CADA,CAJA,CADF,CA2KH","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { ethers } from \"ethers\";\nimport { Contract } from \"@ethersproject/contracts\";\nimport styled from 'styled-components';\nimport { RINKEBY_ID, addresses, abis } from \"@uniswap-v2-app/contracts\";\nimport Container from '@material-ui/core/Container';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\nimport TextField from '@material-ui/core/TextField';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Select from '@material-ui/core/Select';\nimport { makeStyles } from '@material-ui/core/styles';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport Button from '@material-ui/core/Button';\nimport Avatar from '@material-ui/core/Avatar';\nimport ipfs from '../../ipfs';\nimport CloudUploadIcon from '@material-ui/icons/CloudUpload';\nimport FacebookLogin from 'react-facebook-login';\nimport PolicyIcon from '@material-ui/icons/Policy';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport AccountCircle from '@material-ui/icons/AccountCircle';\nimport FacebookIcon from '@material-ui/icons/Facebook';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport { DateTimePicker, MuiPickersUtilsProvider } from \"@material-ui/pickers\";\nimport DateFnsUtils from '@date-io/date-fns'; // choose your lib\nimport Backdrop from '@material-ui/core/Backdrop';\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\n\nconst useStyles = makeStyles((theme) => ({\n    container: {\n      marginTop: \"20px\",\n      width: '800px',\n      marginLeft: 'auto',\n      marginRight: 'auto',\n      backgroundColor: 'white',\n      padding: '30px 30px 30px 30px',\n      borderRadius: '10px'\n    },\n    avatar: {\n      margin: theme.spacing(1),\n      backgroundColor: theme.palette.secondary.main,\n    },\n    paper: {\n      marginTop: theme.spacing(8),\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n    },\n    textField: {\n      marginLeft: theme.spacing(1),\n      marginRight: theme.spacing(1),\n      width: 200,\n    },\n    form: {\n      width: '100%', // Fix IE 11 issue.\n      marginTop: theme.spacing(3),\n    },\n}));\n\n\nexport default function PolicyInputPanel() {\n    const classes = useStyles()\n\n    const [loading, setLoading] = useState(false);\n    const [policyName, setPolicyName] = useState(0);\n    const [policyType, setPolicyType] = useState(0);\n    const [policyContent, setPolicyContent] = useState('');\n    const [policyPremium, setPolicyPremium] = useState(0);\n    const [policyStart, setPolicyStart] = useState(new Date());\n    const [policyEnd, setPolicyEnd] = useState(new Date());\n    const [policyDeadline, setPolicyDeadline] = useState(new Date());\n\n    const [buffer, setBuffer] = useState('');\n    const [contentHash, setContentHash] = useState('');\n    const [login, setLogin] = useState(false);\n    const [data, setData] = useState({});\n  \n    const responseFacebook = (response) => {\n      console.log(response);\n      setData(response);\n      if (response.accessToken) {\n        setLogin(true);\n      } else {\n        setLogin(false);\n      }\n    }\n\n\n    function dateToUnix(value) {\n        const date = new Date(value);\n        return parseInt(date.getTime() / 10**3);\n    }\n\n    const captureFile = async event => {\n      setLoading(true);\n      console.log('capture file...');\n      event.preventDefault();\n      const file = event.target.files[0];\n      const reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n      reader.onloadend = () => {\n        setBuffer(Buffer.from(reader.result));\n      }\n      // upload\n      let data = buffer;\n      console.log('Submit this: ', data);\n      const postResponse = await ipfs.add(data);\n      console.log(\"hash: \", postResponse['path']);\n      setPolicyContent(postResponse['path']);\n      setLoading(false);\n    }\n\n\n    async function createPolicy() {\n        try {\n          console.log(ethers.utils.parseEther(policyPremium))\n          console.log(dateToUnix(policyStart), dateToUnix(policyEnd))\n          console.log(dateToUnix(policyDeadline))\n            let tx;\n            setLoading(true);\n            const provider = new ethers.providers.Web3Provider(window.ethereum);\n            const signer = provider.getSigner()\n            const policyFactoryContract = new Contract(addresses[RINKEBY_ID].policyFactory, abis.policyFactory, signer);\n            console.log(policyFactoryContract)\n            tx = await policyFactoryContract.createPolicy(\n                policyName,\n                policyType,\n                ethers.utils.parseEther(policyPremium),\n                dateToUnix(policyStart),\n                dateToUnix(policyEnd),\n                policyContent,\n                dateToUnix(policyDeadline),\n            );\n          // until transactionHash is mined.\n            await provider.waitForTransaction(tx.hash);\n            setLoading(false);\n            console.log(tx);\n            } catch (err) {\n            console.log(err)\n            }\n            setLoading(false);\n        }\n    return (\n      <div>\n        <Backdrop className={classes.backdrop} open={loading} >\n                <CircularProgress color=\"inherit\" />\n      </Backdrop>\n      <MuiPickersUtilsProvider utils={DateFnsUtils}>\n      <Container component=\"main\" maxWidth=\"md\">\n        <CssBaseline />\n        <div className={classes.paper}>\n        <Grid container justify = \"center\">\n      </Grid>\n        <Grid container>\n          <FacebookLogin\n          appId=\"360104115420180\"\n          autoLoad={false}\n          fields=\"name,email\"\n          scope=\"public_profile\"\n          size=\"small\"\n          callback={responseFacebook}\n          icon=\"fa-facebook\" />\n        </Grid>\n      <form className={classes.form} noValidate>\n      <Grid container spacing={4}>\n      <Grid item xs={12} sm={6}>\n          <TextField\n            required\n            id=\"Proposer\"\n            label=\"Proposer\"\n            value={data.name}\n            disabled\n            fullWidth\n            InputProps={{\n              startAdornment: (\n                <InputAdornment position=\"start\">\n                  <AccountCircle />\n                </InputAdornment>\n              ),\n            }}\n          />\n        </Grid>\n        <Grid item xs={12} sm={6}>\n          <TextField\n            required\n            id=\"UserId\"\n            label=\"UserId\"\n            value={data.id}\n            disabled\n            fullWidth\n            InputProps={{\n              startAdornment: (\n              <InputAdornment position=\"start\">\n                <FacebookIcon />\n              </InputAdornment>\n              ),\n            }}\n          />\n        </Grid>\n        <Grid item xs={12} sm={6}>\n          <TextField\n            required\n            id=\"policyName\"\n            label=\"Title\"\n            onChange={e => setPolicyName(e.target.value)}\n            fullWidth\n          />\n        </Grid>\n        <Grid item xs={12} sm={6}>\n        <TextField\n          id=\"standard-select-type\"\n          required\n          select\n          label=\"Type\"\n          value={policyType}\n          onChange={e => setPolicyType(e.target.value)}\n          helperText=\"Please select your insurance type\"\n          fullWidth\n        >\n            <MenuItem value=\"Cyper Insurance\">Cyper Insurance</MenuItem>\n            <MenuItem value=\"Health Insurance\">Health Insurance</MenuItem>\n            <MenuItem value=\"Investment Insurance\">Investment Insurance</MenuItem>\n            <MenuItem value=\"Auto Insurance\">Auto Insurance</MenuItem>\n            <MenuItem value=\"Oracle BTC\">Oracle BTC insurance</MenuItem>\n            </TextField>\n        </Grid>\n        \n        <Grid item xs={12} sm={6}>\n        <DateTimePicker\n            value={policyStart}\n            disablePast\n            onChange={e => setPolicyStart(e)}\n            label=\"Start time\"\n            showTodayButton\n            fullWidth\n          />\n        </Grid>\n\n        <Grid item xs={12} sm={6}>\n        <DateTimePicker\n            value={policyEnd}\n            disablePast\n            onChange={e => setPolicyEnd(e)}\n            label=\"End time\"\n            showTodayButton\n            fullWidth\n          />\n        </Grid>\n        <Grid item xs={12} sm={6}>\n        <DateTimePicker\n            value={policyDeadline}\n            disablePast\n            onChange={e => setPolicyDeadline(e)}\n            label=\"Deadline\"\n            showTodayButton\n            fullWidth\n          />\n        </Grid>\n        \n        <Grid item xs={12} sm={9}>\n          <TextField\n            required\n            id=\"policyContent\"\n            name=\"policyContent\"\n            label=\"Content Hash\"\n            value={policyContent}\n            disabled\n            fullWidth\n          />\n        </Grid>\n        <Grid item xs={12} sm={3}>\n        <input\n                type=\"file\"\n                accept=\".pdf,.word,.jpg\"\n                className={classes.input}\n                style={{ display: 'none', }}\n                id=\"contained-button-file\"\n                multiple\n                onChange={e => captureFile(e)}\n              />\n            <label htmlFor=\"contained-button-file\">\n            <Button variant=\"contained\" component=\"span\" className={classes.button} startIcon={<CloudUploadIcon />}>\n              Upload Policy\n            </Button>\n            </label> \n        </Grid>\n        <Grid item xs={12} sm={6}>\n          <TextField\n            required\n            id=\"Policypremium\"\n            name=\"Policypremium\"\n            label=\"Claim Base\"\n            onChange={e => setPolicyPremium(e.target.value)}\n            fullWidth\n          />\n        </Grid>\n        \n        <Grid justify=\"flex-end\" container>\n          <Grid>\n          <Button variant=\"contained\" component=\"span\" onClick={createPolicy} className={classes.button}>\n              Create\n          </Button>\n          </Grid>\n        </Grid>\n      </Grid>\n      </form>\n    </div>\n    \n  </Container>\n  </MuiPickersUtilsProvider>\n\n  </div>\n    )\n}"]},"metadata":{},"sourceType":"module"}